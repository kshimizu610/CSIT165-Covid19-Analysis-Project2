---
title: "Project 2"
author: "Team Members: Adrian Missier & Kiyoko Shimizu "
date: "`r Sys.Date()`"
output: html_document
---
```{r setup, include = FALSE}

#### Load necessary packages ####
options(repos = c(CRAN = "https://cloud.r-project.org/"))
if(!require(tidyverse)){install.packages("tidyverse")}
if(!require(knitr)){install.packages("knitr")}
if(!require(leaflet)){install.packages("leaflet")}

library(tidyverse)
library(knitr)
library(leaflet)
```

## Background
The World Health Organization has recently employed a new data science initiative, *CSIT-165*, that uses data science to characterize pandemic diseases. 
*CSIT-165* disseminates data driven analyses to global decision makers.

*CSIT-165* is a conglomerate comprised of two fabricated entities: World Health Organization (WHO) and U.S. Pandemic Response Team (USPRT). 
Each of us will assume a role as a data scientist from one of these two entities.(State our roles here?)

## Data
> [2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by John Hopkins CSSE](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series)

Data for 2019 Novel Coronavirus is operated by the John Hopkins University Center for Systems Science and Engineering (JHU CSSE). Data includes daily time series CSV summary tables, including confirmations, recoveries, and deaths. 
Country/region are countries/regions hat conform to World Health Organization (WHO).
Lat and Long refer to coordinates references for the user. Date fields are stored in MM/DD/YYYY format.


```{r WHO_datasets_download}
# URLs for global data sets for COVID-19 associated confirmations and deaths 
deaths_global_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"
  
confirmed_global_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"

# Create curl command
deaths_global_command<-paste("curl",deaths_global_url, "-o", "time_series_covid19_deaths_global.csv")
global_command <- paste("curl", confirmed_global_url, "-o", "time_series_covid19_confirmed_global.csv")

# Run the commands
system(deaths_global_command)
system(global_command)

# Read data from .csv files
deaths_global_data <- read.csv("time_series_covid19_deaths_global.csv", stringsAsFactors = FALSE)
confirmed_global_data <- read.csv("time_series_covid19_confirmed_global.csv", stringsAsFactors= FALSE)  

```
```{r USPRT_datasets_download}
# URLs for US data sets for COVID-19 associated confirmations and deaths 


```

```{r prepare_data}
# Clean and prepare global data
clean_global_data <- function(data) {
  cleaned <- data %>%
    filter(!is.na(Lat), !is.na(Long), Lat != 0, Long != 0) 
  return(cleaned)
}

confirmed_global_cleaned <- clean_global_data(confirmed_global_data)
deaths_global_cleaned <- clean_global_data(deaths_global_data)

# Filter out cruise ships and invalid coordinates based on Lat/Long
confirmed_global_cleaned <- confirmed_global_cleaned %>%
  filter(!is.na(Lat), !is.na(Long), Lat != 0, Long != 0)
  #filter(if_all(where(is.numeric), ~ . >= 0))

deaths_global_cleaned <- deaths_global_cleaned %>%
  filter(!is.na(Lat), !is.na(Long), Lat != 0, Long != 0)
  #filter(if_all(where(is.numeric), ~ . >= 0))

# Clean and prepare US data 

```
## Project Objectives

### Objective 1: Global Map - Covid-19 Confirmations & Deaths
```{r ob1}
# Identify the column with last date
last_date <- names(confirmed_global_cleaned)[ncol(confirmed_global_cleaned)]

# Sum confirmations and deaths of provinces into one value for each country they belong to 
confirmed_global_summed <- confirmed_global_cleaned %>% 
  group_by(Country.Region) %>% 
  summarise(confirmed = sum(.data[[last_date]], na.rm = TRUE),
            Lat = mean(Lat, na.rm = TRUE),
            Long = mean(Long, na.rm = TRUE))
            
deaths_global_summed <- deaths_global_cleaned %>% 
  group_by(Country.Region) %>% 
  summarise(deaths = sum(.data[[last_date]], na.rm = TRUE))

# Join confirmed and deaths data frames
global_joined <- left_join(confirmed_global_summed, deaths_global_summed, by = "Country.Region")

# Find the first, second and third quartiles
quartiles_confirmed <- quantile(global_joined$confirmed, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
quartiles_deaths <- quantile(global_joined$deaths, probs = c(0.25,0.5,0.75), na.rm = TRUE)

# Set colors for quartiles
global_joined  <- global_joined %>% 
  mutate(
    Color_confirmed = case_when(
    confirmed <= quartiles_confirmed[1] ~ "blue",
    confirmed <= quartiles_confirmed[2] ~"gray",
    confirmed <= quartiles_confirmed[3] ~ "red",
    TRUE ~ "red"
    ),
    Color_deaths = case_when(
      deaths <= quartiles_deaths[1] ~ "blue",
      deaths <= quartiles_deaths[2] ~"gray",
      deaths <= quartiles_deaths[3] ~ "red",
      TRUE ~ "red"
    )
  )

# Make map using leaflet
leaflet(global_joined) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  
  # Add layer for confirmed cases
  addCircleMarkers(
    group = "confirmed",
    lng =~ Long, lat = ~Lat,
    radius = ~log1p(confirmed)/2,
    color = ~Color_confirmed,
    label = ~`Country.Region`,
    popup = ~paste0("<b>Country:</b> ", `Country.Region`, "<br>",
                   "<b>Confirmations:</b> ", confirmed),
    stroke = FALSE, fillOpacity = 0.7
  ) %>% 
  
  # Add layer for deaths
  addCircleMarkers(
    group = "deaths",
    lng = ~Long, lat = ~Lat,
    radius = ~log1p(deaths)/2,
    color = ~Color_deaths,
    label = ~`Country.Region`,
    popup = ~paste0("<b>Country:</b> ", `Country.Region`, "<br>",
                   "<b>Deaths:</b> ", deaths),
    stroke = FALSE,fillOpacity = 0.7
  ) %>%
  
  # Add checkboxes
  addLayersControl(
    overlayGroups = c("Confirmed","Deaths"),
    options = layersControlOptions(collapsed = FALSE)
  )
```
### Objective 2: Table of Covid-19 Hot Spots
```{r ob2}


```

### Objective 3: Covid-19 Confirmations in California
```{r ob3}

```

### Objective 4: Exploring Relationship between -  Population & Confirmed Counts, Death Counts & Confirmed Counts


```{r ob4}

```


### GitHub Log
```{bash gitlog } 
git log --pretty=format:"%nSubject: %s%nAuthor: %aN%nDate: %aD%nBody: %b"
```
[GitHub repository] 


